<!DOCTYPE html>

<html lang="zh-TW">

<head>

    <meta charset="UTF-8">

    <title>é‹å‹•é¦¬æ‹‰æ¾å³æ™‚çœ‹æ¿</title>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    

    <style>

        /* ç°¡å–®çš„è·‘é“æ¨£å¼ */

        body { font-family: "Microsoft JhengHei", sans-serif; text-align: center; background: #eceff1; }

        #track { width: 90%; max-width: 800px; background: #333; margin: 20px auto; padding: 10px; border-radius: 8px; position: relative; }

        .lane { height: 50px; border-bottom: 1px dashed #777; position: relative; display: flex; align-items: center; overflow: hidden; }

        .runner { position: absolute; transition: left 1s; display: flex; align-items: center; }

        .avatar { font-size: 24px; margin-right: 5px; }

        .label { color: white; font-size: 12px; background: rgba(0,0,0,0.6); border-radius: 4px; padding: 2px 6px; white-space: nowrap; }

        .controls { margin: 20px; padding: 20px; background: white; display: inline-block; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }

    </style>

</head>

<body>



    <h1>ğŸƒâ€â™‚ï¸ å³æ™‚é‹å‹•é¦¬æ‹‰æ¾ ğŸƒâ€â™€ï¸</h1>

    

    <div id="track">

        </div>



    <div class="controls">

        <input type="text" id="name" placeholder="ä½ çš„å§“å">

        <input type="number" id="mins" placeholder="é‹å‹•åˆ†é˜æ•¸" style="width: 80px;">

        <button onclick="addMins()">å¢åŠ é€²åº¦</button>

    </div>



    <script>

// --- 1. åˆå§‹åŒ– Firebase ---
const firebaseConfig = {
    apiKey: "AIzaSyDqX_tZqqfw0txXpd-b4AWuolhgQgU6lLU",
    authDomain: "runrundondon-31b12.firebaseapp.com",
    databaseURL: "https://runrundondon-31b12-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "runrundondon-31b12",
    storageBucket: "runrundondon-31b12.firebasestorage.app",
    messagingSenderId: "466713105396",
    appId: "1:466713105396:web:c0651103b028978cd9dfa1"
};

// ç¢ºä¿ SDK å·²è¼‰å…¥å¾ŒåŸ·è¡Œ
firebase.initializeApp(firebaseConfig);

// é‡é»ï¼šæ‰‹å‹•æŒ‡å®šè³‡æ–™åº«ç¶²å€ï¼Œé¿å… Region åµæ¸¬å‡ºéŒ¯
const db = firebase.database(); 

// --- 2. å¢åŠ æ™‚é–“çš„é‚è¼¯ ---
function addMins() {
    const nameInput = document.getElementById('name');
    const minsInput = document.getElementById('mins');
    const name = nameInput.value.trim();
    const mins = parseInt(minsInput.value);

    if (!name || isNaN(mins)) {
        alert("è«‹è¼¸å…¥å§“åèˆ‡åˆ†é˜æ•¸");
        return;
    }

    const userRef = db.ref('players/' + name);
    
    // è®€å–ä¸¦æ›´æ–°
    userRef.once('value').then(snapshot => {
        const currentScore = (snapshot.val() && snapshot.val().score) ? snapshot.val().score : 0;
        return userRef.set({
            name: name,
            score: currentScore + mins,
            lastUpdate: Date.now()
        });
    }).then(() => {
        alert("æ›´æ–°æˆåŠŸï¼");
        minsInput.value = ''; // åªæ¸…ç©ºåˆ†é˜
    }).catch(error => {
        console.error("Firebase Error:", error);
        alert("å¯«å…¥å¤±æ•—ï¼åŸå› ï¼š" + error.message);
    });
}

// --- 3. ç›£è½è³‡æ–™ ---
db.ref('players').on('value', (snapshot) => {
    const players = snapshot.val();
    const track = document.getElementById('track');
    track.innerHTML = ''; 

    if (!players) {
        track.innerHTML = '<p style="color:gray">ç›®å‰é‚„æ²’æœ‰è³‡æ–™</p>';
        return;
    }

    const GOAL = 500; // ä½ å¯ä»¥èª¿æ•´çµ‚é»ç·š

    for (let id in players) {
        const p = players[id];
        const progress = Math.min((p.score / GOAL) * 85, 92); 
        
        const lane = document.createElement('div');
        lane.className = 'lane';
        lane.innerHTML = `
            <div class="runner" style="left: ${progress}%">
                <span class="avatar">ğŸƒ</span>
                <span class="label">${p.name}: ${p.score} min</span>
            </div>
        `;
        track.appendChild(lane);
    }
});

    </script>

</body>


</html>
