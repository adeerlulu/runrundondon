<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·‘è·‘å‹•å‹• RunRun! DonDon!</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        :root {
            --header-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --track-color: #3d3d3d;
            --path-color: #ffd700;
        }

        body { 
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; 
            background: #f0f2f5; margin: 0; padding: 20px; text-align: center; 
        }

        .title-container { margin-bottom: 20px; }
        h1 { font-size: 2.5rem; margin: 0; background: var(--header-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900; }
        .subtitle { font-size: 1.2rem; color: #555; font-weight: 700; }

        /* S å‹è·‘é“å®¹å™¨ */
        #s-track-map { 
            width: 100%; max-width: 600px; margin: 30px auto; 
            background: #e0e0e0; border-radius: 20px; padding: 40px 20px;
            display: flex; flex-direction: column; gap: 40px;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.1);
            position: relative;
        }

        /* æ¯ä¸€å±¤è·‘é“ */
        .track-row {
            height: 20px; background: var(--track-color); border-radius: 10px;
            position: relative; width: 100%;
        }

        /* è½‰å½è™• */
        .turn {
            position: absolute; width: 40px; height: 60px;
            border: 20px solid var(--track-color);
            border-top: none; border-bottom: none;
            z-index: 1;
        }
        .turn-right { right: -20px; top: 0; border-radius: 0 40px 40px 0; border-left: none; }
        .turn-left { left: -20px; top: 0; border-radius: 40px 0 0 40px; border-right: none; }

        /* è·‘è€…æ¨™è¨˜ */
        .runner { 
            position: absolute; width: 40px; height: 40px;
            transition: all 1s ease-in-out; z-index: 10;
            display: flex; flex-direction: column; align-items: center;
            transform: translateY(-35px);
        }
        .avatar { font-size: 30px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .label { 
            background: rgba(0,0,0,0.8); color: white; font-size: 10px; 
            padding: 2px 6px; border-radius: 10px; white-space: nowrap;
            border: 1px solid #00f2fe;
        }

        /* æ§åˆ¶å€ */
        .controls { 
            margin-top: 20px; padding: 25px; background: white; 
            display: inline-flex; flex-wrap: wrap; justify-content: center;
            gap: 15px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); 
        }
        .input-wrapper { position: relative; display: flex; align-items: center; }
        input { padding: 12px; border: 2px solid #eee; border-radius: 10px; outline: none; }
        .unit-input { padding-right: 45px; }
        .unit-input::after { content: "min"; position: absolute; right: 10px; color: #aaa; font-size: 12px; }
        
        button { 
            padding: 12px 25px; background: var(--header-gradient); color: white; 
            border: none; border-radius: 10px; cursor: pointer; font-weight: 800;
        }
    </style>
</head>
<body>

    <div class="title-container">
        <h1>è·‘è·‘å‹•å‹•</h1>
        <div class="subtitle">RunRun! DonDon!</div>
    </div>
    
    <div id="s-track-map">
        <div class="track-row" id="row-0"><div class="turn turn-right"></div></div>
        <div class="track-row" id="row-1"><div class="turn turn-left"></div></div>
        <div class="track-row" id="row-2"><div class="turn turn-right"></div></div>
        <div class="track-row" id="row-3"><div class="turn turn-left"></div></div>
        <div class="track-row" id="row-4"></div> </div>

    <div class="controls">
        <input type="text" id="name" placeholder="é‹å‹•å®¶">
        <div class="input-wrapper unit-input">
            <input type="number" id="mins" placeholder="ä»Šæ—¥æ™‚æ•¸">
        </div>
        <input type="password" id="pw" placeholder="é€šé—œå¯†èª">
        <button onclick="addMins()">å›å ±é€²åº¦</button>
    </div>
    <p style="color: #888;">çµ‚é»ç›®æ¨™ï¼š7800 åˆ†é˜ | S å‹æŒ‘æˆ°è³½</p>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDqX_tZqqfw0txXpd-b4AWuolhgQgU6lLU",
            authDomain: "runrundondon-31b12.firebaseapp.com",
            databaseURL: "https://runrundondon-31b12-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "runrundondon-31b12",
            storageBucket: "runrundondon-31b12.firebasestorage.app",
            messagingSenderId: "466713105396",
            appId: "1:466713105396:web:c0651103b028978cd9dfa1"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        window.addMins = function() {
            const name = document.getElementById('name').value.trim();
            const mins = parseInt(document.getElementById('mins').value);
            const pw = document.getElementById('pw').value;

            if (pw !== "hello") { alert("ğŸ”’ å¯†ç¢¼ä¸æ­£ç¢ºï¼"); return; }
            if (!name || isNaN(mins)) { alert("è«‹å¡«å¯«æ­£ç¢ºè³‡è¨Š"); return; }

            const userRef = db.ref('players/' + name);
            userRef.once('value').then(snapshot => {
                const current = (snapshot.val() && snapshot.val().score) ? snapshot.val().score : 0;
                return userRef.update({ name, score: current + mins });
            }).then(() => {
                document.getElementById('mins').value = ''; 
                document.getElementById('pw').value = '';
                alert("ğŸ’ª ç´€éŒ„æˆåŠŸï¼");
            });
        };

        db.ref('players').on('value', (snapshot) => {
            const players = snapshot.val();
            // æ¸…é™¤èˆŠçš„è·‘è€…
            document.querySelectorAll('.runner').forEach(r => r.remove());

            if (!players) return;

            const GOAL = 7800;
            const ROWS = 5;
            const MINS_PER_ROW = GOAL / ROWS; // æ¯å±¤ 1560 åˆ†é˜

            Object.values(players).forEach(p => {
                let score = Math.min(p.score, GOAL);
                let rowIndex = Math.floor(score / MINS_PER_ROW);
                if (rowIndex >= ROWS) rowIndex = ROWS - 1;

                let rowProgress = (score % MINS_PER_ROW) / MINS_PER_ROW;
                let leftPercent;

                // å¶æ•¸å±¤å¾å·¦å¾€å³ (0, 2, 4)ï¼Œå¥‡æ•¸å±¤å¾å³å¾€å·¦ (1, 3)
                if (rowIndex % 2 === 0) {
                    leftPercent = rowProgress * 100;
                } else {
                    leftPercent = 100 - (rowProgress * 100);
                }

                const runner = document.createElement('div');
                runner.className = 'runner';
                runner.style.left = `${leftPercent}%`;
                runner.innerHTML = `
                    <span class="avatar">ğŸƒ</span>
                    <span class="label">${p.name}: ${p.score}</span>
                `;
                
                document.getElementById(`row-${rowIndex}`).appendChild(runner);
            });
        });
    </script>
</body>
</html>
